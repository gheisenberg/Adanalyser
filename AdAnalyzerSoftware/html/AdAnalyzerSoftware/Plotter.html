<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Plotter</title>
  <meta name="keywords" content="Plotter">
  <meta name="description" content="Encapsulates functionality to plot PDF figures and write csv files.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html AdAnalyzerSoftware -->
<h1>Plotter
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Encapsulates functionality to plot PDF figures and write csv files.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">Encapsulates functionality to plot PDF figures and write csv files.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="Plotter.html" class="code" title="">Plotter</a>	Encapsulates functionality to plot PDF figures and write csv files.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="AnalyseAction.html" class="code" title="">AnalyseAction</a>	Performs analysis steps for valid subjects</li><li><a href="FilterAction.html" class="code" title="">FilterAction</a>	Performs filter calculation steps</li><li><a href="Plotter.html" class="code" title="">Plotter</a>	Encapsulates functionality to plot PDF figures and write csv files.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function writeStatistics(self,stats, fName)</a></li><li><a href="#_sub2" class="code">function writeCSV(self,fName,format,data)</a></li><li><a href="#_sub3" class="code">function plotECGRecurrence(self,subjectName,config,videoName,ecgData)</a></li><li><a href="#_sub4" class="code">function plotEDARecurrence(self,subjectName,config,videoName,edaData)</a></li><li><a href="#_sub5" class="code">function plotBehavioralCharacteristics(self,subjectName,videoNum,outputDir,frequencies,intervals)</a></li><li><a href="#_sub6" class="code">function plotHRV(self,ecgValues,outputDir,subjName,videoDef)</a></li><li><a href="#_sub7" class="code">function plotRawEEGFigures(self,rawValues,filteredValues,quality,subjectName,electrode,config)</a></li><li><a href="#_sub8" class="code">function plotEEGQualityFigures(self,unfilteredQuality,filteredQuality,validVideosPerSubject,validSubjects,videoDefs,config,numSubjects)</a></li><li><a href="#_sub9" class="code">function plotSubVideoEDA(self,videos,edaValues,videoDefs,subjectName,fPath,stats)</a></li><li><a href="#_sub10" class="code">function plotEDA(self,videoDef,fPath,edaValues,detrended)</a></li><li><a href="#_sub11" class="code">function plotFrequencys(self,videoLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,resolution,intervals,edaSubVideoList)</a></li><li><a href="#_sub12" class="code">function plotFrequencysWithBaselineMagnitude(self,videoLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,baselineTheta,baselineAlpha,baselineBeta1,baselineBeta2,baselineTEI,resolution,intervals,t_title)</a></li><li><a href="#_sub13" class="code">function massAndTime = calculateMassAndTime(self,values,numDataPoints, mean)</a></li><li><a href="#_sub14" class="code">function [videoStartPoints,videoLabels,intervals,completeVidLength] = calculateVideoStartPointsAndIntervals(self,videoDef)</a></li><li><a href="#_sub15" class="code">function plotIntervals(self,intervals,yPos,scaleFac,labels,color)</a></li><li><a href="#_sub16" class="code">function plotVideoStartPoints(self,startPoints,labels,yPos,scaleFac)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%Encapsulates functionality to plot PDF figures and write csv files.</span>
0002 classdef <a href="Plotter.html" class="code" title="">Plotter</a>
0003     methods
0004         
0005         <span class="comment">%% Saves statistics as PDF</span>
0006         <span class="comment">%   stats: statistics as String</span>
0007         <span class="comment">%   fName: File name as String</span>
0008         <a name="_sub0" href="#_subfunctions" class="code">function writeStatistics(self,stats, fName)</a>
0009             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0010             axes(<span class="string">'Position'</span>,[0 0.1 1 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0011             text(0.0,0.5,stats,<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,8);
0012             orient(fig,<span class="string">'tall'</span>);
0013             print(fName,<span class="string">'-dpdf'</span>,fig);
0014             close(fig);
0015         <span class="keyword">end</span>
0016         
0017         <span class="comment">%% Writes array or cell array to csv file with given format and file name</span>
0018         <span class="comment">%  fName: Name of the File to write as String</span>
0019         <span class="comment">%  format: Format String</span>
0020         <span class="comment">%  data: CellArray or Array</span>
0021         <a name="_sub1" href="#_subfunctions" class="code">function writeCSV(self,fName,format,data)</a>
0022             fid = fopen(fName,<span class="string">'w'</span>);
0023             <span class="keyword">if</span> iscell(data)
0024                 fprintf(fid,format,data{:});
0025             <span class="keyword">else</span>
0026                 fprintf(fid,format,data);
0027             <span class="keyword">end</span>
0028             fclose(fid);
0029         <span class="keyword">end</span>
0030         
0031         <span class="comment">%% Prints recurrence plots for ECG</span>
0032         <span class="comment">%  subjectName: Name of the Subject as String</span>
0033         <span class="comment">%  config: Config</span>
0034         <span class="comment">%  videoName: String</span>
0035         <span class="comment">%  ecgData: ECG values for Subject as double[]</span>
0036         <a name="_sub2" href="#_subfunctions" class="code">function plotECGRecurrence(self,subjectName,config,videoName,ecgData)</a>
0037             N = length(ecgData);
0038             S = zeros(N, N);
0039             time = zeros(N,1);
0040             <span class="comment">% Calculate time in seconds for x axis</span>
0041             <span class="keyword">for</span> i=1:N
0042                 time(i) = round(sum(ecgData(1:i))/1000);
0043             <span class="keyword">end</span>
0044             <span class="keyword">for</span> i = 1:N
0045                 S(:,i) = abs( repmat( ecgData(i), N, 1 ) - ecgData(:) );
0046             <span class="keyword">end</span>
0047             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0048             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0049             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);            
0050             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0051             subplot(2,1,1);
0052             imagesc(time, time, S);
0053             axis square;
0054             xlabel(<span class="string">'Time [s]'</span>);
0055             ylabel(<span class="string">'Time [s]'</span>);
0056             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)            
0057             h = colorbar(<span class="string">'eastoutside'</span>);
0058             freezeColors;
0059             freez = cbfreeze(h);
0060             cblabel(<span class="string">'Time [ms]'</span>);
0061             set(freez, <span class="string">'Position'</span>, [0.75 0.585 0.05 0.34]);
0062             title([<span class="string">'Distance map of '</span> videoName <span class="string">' phase space trajectory for subject'</span> subjectName]);
0063             
0064             subplot(2,1,2);
0065             maxDiff = max(max(S) - min(S))*0.001;
0066             <span class="keyword">if</span> (config.RecurrenceThreshold ~= 0)
0067                 maxDiff = config.RecurrenceThreshold; 
0068             <span class="keyword">end</span>
0069             imagesc(time, time, S &lt; 1);
0070             axis square;
0071             colormap([1 1 1;0 0 0]);
0072             xlabel(<span class="string">'Time [s]'</span>);
0073             ylabel(<span class="string">'Time [s]'</span>);
0074             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)
0075             title([videoName <span class="string">' recurrence plot for subject '</span> subjectName <span class="string">' with threshold '</span> num2str(maxDiff)]);
0076             fName = [config.OutputDirectory <span class="string">'/'</span> subjectName <span class="string">'_'</span> videoName <span class="string">' _recurrence.pdf'</span>];
0077             print(fName,<span class="string">'-dpdf'</span>,fig);
0078         <span class="keyword">end</span>
0079         
0080         <span class="comment">%%Prints recurrence plots for EDA</span>
0081         <span class="comment">%  subjectName: Name of the Subject as String</span>
0082         <span class="comment">%  config: Config</span>
0083         <span class="comment">%  videoName: String</span>
0084         <span class="comment">%  edaData: EDA values for Subject as double[]</span>
0085         <a name="_sub3" href="#_subfunctions" class="code">function plotEDARecurrence(self,subjectName,config,videoName,edaData)</a>
0086             N = length(edaData);
0087             S = zeros(N, N);
0088             time = zeros(N,1);
0089             <span class="comment">% Calculate time in seconds for x axis</span>
0090             <span class="keyword">for</span> i=1:N
0091                 time(i) = round(sum(edaData(1:i))/5);
0092             <span class="keyword">end</span>
0093             <span class="keyword">for</span> i = 1:N
0094                 S(:,i) = abs( repmat( edaData(i), N, 1 ) - edaData(:) );
0095             <span class="keyword">end</span>
0096             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0097             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0098             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);            
0099             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0100             subplot(2,1,1);
0101             imagesc(time, time, S);
0102             axis square;
0103             xlabel(<span class="string">'Time [s]'</span>);
0104             ylabel(<span class="string">'Time [s]'</span>);
0105             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)            
0106             h = colorbar(<span class="string">'eastoutside'</span>);
0107             freezeColors;
0108             freez = cbfreeze(h);
0109             cblabel(<span class="string">'Skin Conductance [µS]'</span>);
0110             set(freez, <span class="string">'Position'</span>, [0.75 0.585 0.05 0.34]);
0111             title([<span class="string">'Distance map of '</span> videoName <span class="string">' phase space trajectory for subject'</span> subjectName]);    
0112             subplot(2,1,2);
0113             maxDiff = max(max(S) - min(S))*0.001;
0114             <span class="keyword">if</span> (config.RecurrenceThreshold ~= 0)
0115                 maxDiff = config.RecurrenceThreshold; 
0116             <span class="keyword">end</span>
0117             imagesc(time, time, S &lt; 1);
0118             axis square;
0119             colormap([1 1 1;0 0 0]);
0120             xlabel(<span class="string">'Time [s]'</span>);
0121             ylabel(<span class="string">'Time [s]'</span>);
0122             set(gca,<span class="string">'YDir'</span>,<span class="string">'normal'</span>)
0123             title([videoName <span class="string">' recurrence plot for subject '</span> subjectName <span class="string">' with threshold '</span> num2str(maxDiff)]);
0124             fName = [config.OutputDirectory <span class="string">'/'</span> subjectName <span class="string">'_'</span> videoName <span class="string">' _recurrence.pdf'</span>];
0125             print(fName,<span class="string">'-dpdf'</span>,fig);
0126         <span class="keyword">end</span>
0127         
0128         <span class="comment">%% Plots behavioral characteristics</span>
0129         <span class="comment">%  subjectName: String</span>
0130         <span class="comment">%  videoNum: Number of the video</span>
0131         <span class="comment">%  outputDir: Path to output directory as String</span>
0132         <span class="comment">%  frequencies: eeg frequency data for subject as CellArray of double[]</span>
0133         <span class="comment">%  intervals: intervals of interest as int[]</span>
0134         <a name="_sub4" href="#_subfunctions" class="code">function plotBehavioralCharacteristics(self,subjectName,videoNum,outputDir,frequencies,intervals)</a>
0135             lengthInSeconds = length(frequencies{1,1})/512; 
0136             stepWith = 1;
0137             <span class="keyword">if</span> lengthInSeconds &gt; 30
0138                 xName = 0:5:lengthInSeconds;
0139                 stepWith = 5;
0140             <span class="keyword">else</span>
0141                 xName = 0:lengthInSeconds;
0142             <span class="keyword">end</span>
0143             xTime = xName./stepWith; 
0144             absolutValuesPerSecond = zeros(length(frequencies),lengthInSeconds/stepWith); 
0145             [m,n] = size(absolutValuesPerSecond);
0146             <span class="comment">% make values discrete (calculate mean per second)</span>
0147             <span class="keyword">for</span> i=1:m
0148                 start = 1; 
0149                 ende = 512*stepWith; 
0150                 freqValues = frequencies{:,i}; 
0151                 <span class="keyword">for</span> j=1:n
0152                    absolutValuesPerSecond(i,j) = mean(freqValues(start:ende)); 
0153                    start = start +512*stepWith;
0154                    ende = ende +512*stepWith; 
0155                 <span class="keyword">end</span>
0156             <span class="keyword">end</span>
0157             <span class="comment">%Normalize percental</span>
0158             valuesToPlot = zeros(m,n);
0159             <span class="comment">% Add TEI values</span>
0160             valuesToPlot(m,:) = absolutValuesPerSecond(m,:);
0161             <span class="keyword">for</span> i=1:m 
0162                 <span class="keyword">for</span> j=1:n
0163                    maxPerSecond = max(absolutValuesPerSecond(:,j));
0164                    maximumPos = absolutValuesPerSecond(:,j) == maxPerSecond;
0165                    valuesToPlot(maximumPos,j) = maxPerSecond/sum(absolutValuesPerSecond(:,j))*100;
0166                    <span class="comment">%offset = maxPerSecond*90/100; % if a value exists which is 10% smaller then max, show this value in plot</span>
0167                    <span class="comment">%secondValuePos = absolutValuesPerSecond(:,j) &gt;= offset;</span>
0168                    <span class="comment">%if (secondValuePos~=maximumPos)</span>
0169                    <span class="comment">%     valuesToPlot(secondValuePos,j) = absolutValuesPerSecond(secondValuePos,j) / sum(absolutValuesPerSecond(:,j))*100;</span>
0170                    <span class="comment">%end</span>
0171                 <span class="keyword">end</span>
0172             <span class="keyword">end</span>            
0173             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0174             colormap jet;
0175             bar(valuesToPlot',<span class="string">'stack'</span>);
0176             grid; 
0177             self.plotIntervals(intervals,[0, 100],stepWith,[],<span class="string">'r'</span>);
0178             title([<span class="string">'Behavioral characteristics for subject'</span> subjectName <span class="string">' video '</span> num2str(videoNum)]);
0179             warning(<span class="string">'off'</span>,<span class="string">'MATLAB:legend:IgnoringExtraEntries'</span>); 
0180             legend(<span class="string">'Sleepiness'</span>,<span class="string">'Thinking'</span>,<span class="string">'Relaxation'</span>,<span class="string">'Attention'</span>,<span class="string">'Stress'</span>,<span class="string">'TEI'</span>,<span class="string">'Stimulus'</span>);
0181             warning(<span class="string">'on'</span>,<span class="string">'MATLAB:legend:IgnoringExtraEntries'</span>); 
0182             axis([0 max(xTime)+1 0 100]);
0183             set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xName);
0184             xlabel(<span class="string">'time [s]'</span>);
0185             ylabel(<span class="string">'[%]'</span>); 
0186             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0187             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0188             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0189             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0190             fName = [outputDir <span class="string">'/'</span> subjectName <span class="string">'_video'</span> num2str(videoNum) <span class="string">'_characteristics.pdf'</span>];
0191             print(fName,<span class="string">'-dpdf'</span>,fig);
0192             close(fig);
0193         <span class="keyword">end</span>
0194         
0195 <span class="comment">%         %% Plots momentary frequency</span>
0196 <span class="comment">%         function plotMomentaryFrequency(self,values,conf,subjectName,videoDef)</span>
0197 <span class="comment">%             maxscale = max(values);</span>
0198 <span class="comment">%             minscale=min(values);</span>
0199 <span class="comment">%             [videoStartPoints,videoLabels,intervals,completeVidLength] = self.calculateVideoStartPointsAndIntervals(videoDef);</span>
0200 <span class="comment">%             xName = 0:10:completeVidLength;</span>
0201 <span class="comment">%             xTime = xName .* 5;</span>
0202 <span class="comment">%             fig = figure('Visible','off');</span>
0203 <span class="comment">%             plot(values,'k');</span>
0204 <span class="comment">%             grid;</span>
0205 <span class="comment">%             axis([1 length(values) minscale maxscale]);</span>
0206 <span class="comment">%             set(gca,'XTick',xTime,'XTickLabel',xName);</span>
0207 <span class="comment">%             ylabel('momentary frequencie [µS]');</span>
0208 <span class="comment">%             self.plotVideoStartPoints(videoStartPoints,videoLabels,[minscale, maxscale],max(xTime)/max(xName));</span>
0209 <span class="comment">%             self.plotIntervals(intervals,[minscale, maxscale],max(xTime)/max(xName),[],'r');</span>
0210 <span class="comment">%             xlabel('time [s]');</span>
0211 <span class="comment">%             title(['Momentary frequency for subject' subjectName]);</span>
0212 <span class="comment">%             set(fig, 'PaperType', 'A4');</span>
0213 <span class="comment">%             set(fig, 'PaperOrientation', 'landscape');</span>
0214 <span class="comment">%             set(fig, 'PaperUnits', 'centimeters');</span>
0215 <span class="comment">%             set(fig, 'PaperPositionMode', 'auto');</span>
0216 <span class="comment">%             set(fig, 'PaperPosition', [0.2 0.1 29 20 ]);</span>
0217 <span class="comment">%             print([conf.OutputDirectory '/' subjectName '_EDA_momentary_frequencie'],'-dpdf',fig);</span>
0218 <span class="comment">%             close(fig);</span>
0219 <span class="comment">%         end</span>
0220         
0221         
0222         <span class="comment">%% Plots hrv data</span>
0223         <span class="comment">%  ecgValues: ecgValues for Subject as double[]</span>
0224         <span class="comment">%  outputDir: Path to output directory as String</span>
0225         <span class="comment">%  subjName: The name of the Subject</span>
0226         <span class="comment">%  videoDef: VideoDefinition</span>
0227         <a name="_sub5" href="#_subfunctions" class="code">function plotHRV(self,ecgValues,outputDir,subjName,videoDef)</a>
0228             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0229             time = zeros(length(ecgValues),1);
0230             <span class="comment">% Calculate time in seconds for x axis</span>
0231             <span class="keyword">for</span> i=1:length(ecgValues)
0232                 time(i) = round(sum(ecgValues(1:i))/1000);
0233             <span class="keyword">end</span>
0234             plot(ecgValues,<span class="string">'k'</span>);
0235             grid;
0236             xTime = time(1:20:end);
0237             yMin = min(ecgValues);
0238             yMax = max(ecgValues);
0239             [videoStartPoints,videoLabels,intervals,~] = self.calculateVideoStartPointsAndIntervals(videoDef);
0240             self.plotVideoStartPoints(videoStartPoints,videoLabels,[yMin, yMax],1);
0241             self.plotIntervals(intervals,[yMin, yMax],1,[],<span class="string">'r'</span>);
0242             axis([1 max(xTime) yMin yMax]);
0243             set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xTime);
0244             ylabel(<span class="string">'RR intervals [ms]'</span>);
0245             xlabel(<span class="string">'time [s]'</span>);
0246             m = sprintf(<span class="string">'%.2f'</span>,mean(ecgValues));
0247             sd = sprintf(<span class="string">'%.2f'</span>,std(ecgValues));
0248             title([<span class="string">'HRV values for subject '</span> subjName <span class="string">' (mean='</span> m <span class="string">'ms, sd='</span> sd <span class="string">'ms)'</span>]);
0249             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0250             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0251             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0252             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0253             fName = [outputDir <span class="string">'/'</span> subjName <span class="string">'_HRV.pdf'</span>];
0254             print(fName,<span class="string">'-dpdf'</span>,fig);
0255             close(fig);
0256         <span class="keyword">end</span>
0257         
0258         <span class="comment">%% RawEEG figure plot</span>
0259         <span class="comment">%   rawValues: Raw eeg values as double[]</span>
0260         <span class="comment">%   filteredValues: Filteres eeg values as double[]</span>
0261         <span class="comment">%   quality: Two double values. First is percent outside for</span>
0262         <span class="comment">%   rawValues. Second is percent outside for filtered values</span>
0263         <span class="comment">%   subjectName: The name of the subject as String</span>
0264         <span class="comment">%   config: Config</span>
0265         <a name="_sub6" href="#_subfunctions" class="code">function plotRawEEGFigures(self,rawValues,filteredValues,quality,subjectName,electrode,config)</a>
0266             numRawValues = length(rawValues);
0267             numFilteredValues = length(filteredValues);
0268             fig = figure(<span class="string">'visible'</span>, <span class="string">'off'</span>);
0269             subplot(2,1,1);
0270             plot(rawValues);
0271             grid;
0272             hold on;
0273             line(<span class="string">'XData'</span>,[0 numRawValues],<span class="string">'YData'</span>,[config.LowerThreshold config.LowerThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
0274             line(<span class="string">'XData'</span>,[0 numRawValues],<span class="string">'YData'</span>,[config.UpperThreshold config.UpperThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
0275             hold off;
0276             thresholdString = [<span class="string">'['</span> num2str(config.LowerThreshold) <span class="string">','</span> num2str(config.UpperThreshold) <span class="string">']'</span>];
0277             title ([<span class="string">'Unfiltered EEG raw data for electrode '</span> char(electrode) <span class="string">' of subject '</span> subjectName <span class="string">' ('</span> sprintf(<span class="string">'%3.2f'</span>,quality(1)) <span class="string">'% of data lies outside the interval '</span> thresholdString <span class="string">'µV)'</span>])
0278             ylabel(<span class="string">'amplitude [µV]'</span>);
0279             xlabel(<span class="string">'data point [#]'</span>);
0280             axis([1 numRawValues min(rawValues) max(rawValues)])
0281             set(gca,<span class="string">'YDir'</span>,<span class="string">'reverse'</span>);
0282             subplot(2,1,2);
0283             plot(filteredValues);
0284             grid;
0285             hold on;
0286             line(<span class="string">'XData'</span>,[0 numFilteredValues],<span class="string">'YData'</span>,[config.LowerThreshold config.LowerThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
0287             line(<span class="string">'XData'</span>,[0 numFilteredValues],<span class="string">'YData'</span>,[config.UpperThreshold config.UpperThreshold],<span class="string">'Color'</span>,<span class="string">'r'</span>)
0288             hold off;
0289             title ([<span class="string">'Filtered EEG raw data for subject '</span>, subjectName ,<span class="string">' ('</span>,sprintf(<span class="string">'%3.2f'</span>,quality(2)),<span class="string">'% of data lies outside the interval '</span> thresholdString <span class="string">'µV)'</span>])
0290             ylabel(<span class="string">'amplitude [µV]'</span>)
0291             xlabel(<span class="string">'data point [#]'</span>);
0292             axis([1 numFilteredValues min(rawValues) max(rawValues)])
0293             set(gca,<span class="string">'YDir'</span>,<span class="string">'reverse'</span>);
0294             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0295             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0296             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0297             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0298             print([config.OutputDirectory <span class="string">'/'</span> subjectName <span class="string">'_'</span> char(electrode) <span class="string">'_EEG.pdf'</span>],<span class="string">'-dpdf'</span>,fig);
0299             close(fig);
0300         <span class="keyword">end</span>
0301         
0302         <span class="comment">%% Plots quality index figures for subjects and videos</span>
0303         <span class="comment">%   unfilteredQuality: Percentage of unfiltered eeg values outside interval for each subject</span>
0304         <span class="comment">%   and video as double[][]</span>
0305         <span class="comment">%   filteredQuality: Percentage of filtered eeg values outside interval for each subject</span>
0306         <span class="comment">%   and video as double[][]</span>
0307         <span class="comment">%   validVideosPerSubject: Number of valid baseline eeg, tv</span>
0308         <span class="comment">%   programm and tv commercial videos per subject as double[][]</span>
0309         <span class="comment">%   validSubjects: Total number of valid subjects as double</span>
0310         <span class="comment">%   videoDefs: Video definitions as Cell&lt;VideoDef&gt;</span>
0311         <span class="comment">%   config: Config</span>
0312         <span class="comment">%   numSubjects: total number of subjects as double</span>
0313         <a name="_sub7" href="#_subfunctions" class="code">function plotEEGQualityFigures(self,unfilteredQuality,filteredQuality,validVideosPerSubject,validSubjects,videoDefs,config,numSubjects)</a>
0314             videos = length(videoDefs);
0315             outputFolder= config.OutputDirectory;
0316             h = waitbar(0,[<span class="string">'Writing EEG quality figures for '</span> num2str(videos) <span class="string">' video(s)'</span>]);
0317             xtick = 0:numSubjects;
0318             <span class="keyword">for</span> i = 1:videos
0319                 fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0320                 numberExcluded = length(find(filteredQuality(:,i) &gt;= config.QualityIndex));
0321                 plot(unfilteredQuality(:,i),<span class="string">'b'</span>);
0322                 hold on;
0323                 plot(filteredQuality(:,i),<span class="string">'k'</span>);
0324                 grid;
0325                 hold off;
0326                 line(<span class="string">'XData'</span>,[1 numSubjects],<span class="string">'YData'</span>,[config.QualityIndex config.QualityIndex],<span class="string">'Color'</span>,<span class="string">'r'</span>)
0327                 hold off;
0328                 legend(<span class="string">'Unfiltered EEG Data'</span>,<span class="string">'Filtered EEG Data'</span>,[num2str(config.QualityIndex) <span class="string">'% cutoff for filtered EEG data'</span>]);
0329                 thresholdString = [<span class="string">'['</span> num2str(config.LowerThreshold) <span class="string">','</span> num2str(config.UpperThreshold) <span class="string">']'</span>];
0330                 title ([<span class="string">'Quality index (% of data outside '</span> thresholdString <span class="string">'uV interval) for EEG data for video'</span>,int2str(i),<span class="string">' = '</span>,int2str(numberExcluded),<span class="string">' data sets are excluded'</span>]);
0331                 ylabel(<span class="string">'Quality index [%]'</span>);
0332                 xlabel(<span class="string">'subject [#]'</span>);
0333                 axis([1 numSubjects 0 100]);
0334                 set(gca,<span class="string">'XTick'</span>,xtick,<span class="string">'xTickLabel'</span>,xtick);
0335                 set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0336                 set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
0337                 set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0338                 set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0339                 set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0340                 print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,[outputFolder,<span class="string">'\EEG Quality Index_video'</span>,int2str(i),<span class="string">'.pdf'</span>]);
0341                 close(fig);
0342                 waitbar(i/videos);
0343             <span class="keyword">end</span>
0344             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0345             ytick = 0:videos;
0346             xtick = 0:numSubjects;
0347             bar(validVideosPerSubject,<span class="string">'stack'</span>);
0348             grid on;
0349             legend(<span class="string">'Baseline'</span>,<span class="string">'TV commercial'</span>,<span class="string">'TV program'</span>);
0350             [~,y] = size(validVideosPerSubject);
0351             axis([0 numSubjects+1 0 y+1]);
0352             set(gca,<span class="string">'YTick'</span>,ytick,<span class="string">'yTickLabel'</span>,ytick);
0353             set(gca,<span class="string">'XTick'</span>,xtick,<span class="string">'xTickLabel'</span>,xtick);
0354             tMessage = [<span class="string">'Number of subjects reaching EEG quality criteria: '</span>,int2str(validSubjects)];
0355             title(tMessage);
0356             ylabel(<span class="string">'Number of videos [#]'</span>);
0357             xlabel(<span class="string">'subject [#]'</span>);
0358             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0359             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0360             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0361             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0362             print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,[outputFolder,<span class="string">'\EEG Quality Index - Subjects.pdf'</span>]);
0363             close(fig)
0364             close(h);
0365         <span class="keyword">end</span>
0366         
0367         <span class="comment">%% Plots EDA figures for given videos to given file name</span>
0368         <span class="comment">%   videos: video indicies of videos to plot as doubel[]</span>
0369         <span class="comment">%   edaValues: eda values of subject as Cell of double[]</span>
0370         <span class="comment">%   videoDefs: Cell&lt;VideoDefinition&gt;</span>
0371         <span class="comment">%   subjectName: the name of the subject as String</span>
0372         <span class="comment">%   fPath: file path as String</span>
0373         <span class="comment">%   stats: eda statistics for subject as String</span>
0374         <a name="_sub8" href="#_subfunctions" class="code">function plotSubVideoEDA(self,videos,edaValues,videoDefs,subjectName,fPath,stats)</a>
0375             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0376             allValues=  edaValues(videos);
0377             allValues = vertcat(allValues{:});
0378             yMin = min(allValues);
0379             yMax = max(allValues);
0380             yL = [yMin yMax];
0381             <span class="comment">% choose x axis interval on base of video length</span>
0382             <span class="keyword">for</span> i=1:length(videos);
0383                 videoNum = videos(i);
0384                 videoLength = videoDefs{videoNum}.length;
0385                 labels = [];
0386                 <span class="keyword">if</span> videoLength &gt; 30
0387                     xName = 0:5:videoLength;
0388                     labels = videoDefs{videoNum}.intervals;
0389                 <span class="keyword">else</span>
0390                     xName = 0:videoLength;
0391                 <span class="keyword">end</span>
0392                 xTime = xName .* 5;
0393                 subplot(6,1,i);
0394                 plot(edaValues{videoNum},<span class="string">'k'</span>);
0395                 self.plotIntervals(videoDefs{videoNum}.intervals,yL,max(xTime)/max(xName),labels,<span class="string">'r'</span>);
0396                 grid;
0397                 ylabel([<span class="string">'Video '</span> num2str(videoNum) <span class="string">' [µS]'</span>]);
0398                 l = length(edaValues{videoNum});
0399                 axis([1,l, yL]);
0400                 set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xName);
0401                 <span class="keyword">if</span> (i==1)
0402                     title([<span class="string">'EDA values for the videos '</span> mat2str(videos) <span class="string">' of subject '</span> subjectName]);
0403                 <span class="keyword">end</span>
0404             <span class="keyword">end</span>
0405             xlabel(<span class="string">'Time [s]'</span>);
0406             axes(<span class="string">'Position'</span>,[.08 .30 0.8 1],<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0407             text(0,0,stats,<span class="string">'FontName'</span>,<span class="string">'FixedWidth'</span>,<span class="string">'FontSize'</span>,9);
0408             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0409             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
0410             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0411             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0412             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.2 20 29 ]);
0413             print(fPath,<span class="string">'-dpdf'</span>,fig);
0414             close(fig);
0415         <span class="keyword">end</span>
0416         
0417         <span class="comment">%% Plots complete EDA figure to given file name</span>
0418         <span class="comment">%   videoDef: Cell&lt;VideoDefinition&gt;</span>
0419         <span class="comment">%   fPath: Output file path</span>
0420         <span class="comment">%   edaValues: EDA values as double[]</span>
0421         <span class="comment">%   detrended: boolean</span>
0422         <a name="_sub9" href="#_subfunctions" class="code">function plotEDA(self,videoDef,fPath,edaValues,detrended)</a>
0423             maxscale = max(edaValues);
0424             minscale=min(edaValues);
0425             [videoStartPoints,videoLabels,intervals,completeVidLength] = self.calculateVideoStartPointsAndIntervals(videoDef);
0426             xName = 0:10:completeVidLength;
0427             xTime = xName .* 5;
0428             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0429             plot(edaValues,<span class="string">'k'</span>);
0430             grid;
0431             axis([1 length(edaValues) minscale maxscale]);
0432             set(gca,<span class="string">'XTick'</span>,xTime,<span class="string">'XTickLabel'</span>,xName);
0433             xlabel(<span class="string">'Time [s]'</span>);
0434             self.plotVideoStartPoints(videoStartPoints,videoLabels,[minscale, maxscale],max(xTime)/max(xName));
0435             self.plotIntervals(intervals,[minscale, maxscale],max(xTime)/max(xName),[],<span class="string">'r'</span>);
0436             ylabel(<span class="string">'Skin Conductance [µS]'</span>);
0437             <span class="keyword">if</span> (detrended)
0438                 t = <span class="string">'EDA values (detrended)'</span>;
0439             <span class="keyword">else</span>
0440                 t = <span class="string">'EDA values'</span>;
0441             <span class="keyword">end</span>
0442             title(t);
0443             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0444             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'landscape'</span>);
0445             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0446             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0447             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 29 20 ]);
0448             print(fPath,<span class="string">'-dpdf'</span>,fig);
0449             close(fig);
0450         <span class="keyword">end</span>
0451         
0452         <span class="comment">%% Plots eeg frequency bands for video</span>
0453         <span class="comment">%   videoLength: Length of the video in seconds as double</span>
0454         <span class="comment">%   fPath: Output file path as String</span>
0455         <span class="comment">%   theta_s: Theta values as double[]</span>
0456         <span class="comment">%   alpha_s: Alpha values as double[]</span>
0457         <span class="comment">%   beta1_s: Beta1 values as double[]</span>
0458         <span class="comment">%   beta2_s: Beta2 values as double[]</span>
0459         <span class="comment">%   task_s: TEI values as double[]</span>
0460         <span class="comment">%   resolution: values per second as double</span>
0461         <span class="comment">%   intervals: intervals of interest as int[]</span>
0462         <span class="comment">%   edaSubVideoList: EDA values of video as double[]</span>
0463         <a name="_sub10" href="#_subfunctions" class="code">function plotFrequencys(self,videoLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,resolution,intervals,edaSubVideoList)</a>
0464             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0465             maxscale = max([max(theta_s) max(alpha_s) max(beta1_s) max(beta2_s) ]);
0466             labels = [];
0467             <span class="keyword">if</span> videoLength &gt; 30
0468                 xname = 0:5:videoLength;
0469                 labels = intervals;
0470             <span class="keyword">else</span>
0471                 xname = 0:videoLength;
0472             <span class="keyword">end</span>
0473             xtime = xname .* resolution;
0474             edaXTime = xname .* 5;
0475             <span class="comment">%---------------------</span>
0476             <span class="comment">% subplot(6,1,1)</span>
0477             <span class="comment">% plot(delta_s,'Color',[65/255 105/255 225/255]);</span>
0478             <span class="comment">% grid;</span>
0479             <span class="comment">%  ylabel('Delta');</span>
0480             <span class="comment">% axis([1 length(delta_s) 0 maxscale]);</span>
0481             <span class="comment">%  set(gca,'XTick',xtime,'XTickLabel',xname);</span>
0482             
0483             subplot(6,1,1);
0484             plot(theta_s,<span class="string">'Color'</span>,[0/255 191/255 255/255]);
0485             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0486             grid;
0487             ylabel(<span class="string">'Theta [µV]'</span>);
0488             axis([1 length(theta_s) 0 maxscale]);
0489             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0490             [~,subjName,~] = fileparts(fPath);
0491             t = title([<span class="string">'Frequency bands, task engagement and EDA for subject: '</span> strrep(subjName,<span class="string">'_freq_bands_video'</span>,<span class="string">' video'</span>)]);
0492             tP = get(t,<span class="string">'Position'</span>);
0493             set(t,<span class="string">'Position'</span>,[tP(1) tP(2)+0.3 tP(3)]);
0494             set(t,<span class="string">'FontSize'</span>,12);
0495             
0496             subplot(6,1,2);
0497             plot(alpha_s,<span class="string">'Color'</span>,[0/255 128/255 0/255]);
0498             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0499             grid;
0500             ylabel(<span class="string">'Alpha [µV]'</span>);
0501             axis([1 length(alpha_s) 0 maxscale]);
0502             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0503             
0504             subplot(6,1,3);
0505             plot(beta1_s,<span class="string">'Color'</span>,[255/255 128/255 0/255]);
0506             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0507             grid;
0508             ylabel(<span class="string">'Beta1 [µV]'</span>);
0509             axis([1 length(beta1_s) 0 maxscale]);
0510             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0511             
0512             subplot(6,1,4);
0513             plot(beta2_s,<span class="string">'Color'</span>,[255/255 69/255 0/255]);
0514             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0515             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0516             grid;
0517             ylabel(<span class="string">'Beta2 [µV]'</span>);
0518             axis([1 length(beta2_s) 0 maxscale]);
0519             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0520             
0521             subplot(6,1,5);
0522             plot(task_s,<span class="string">'k'</span>);
0523             self.plotIntervals(intervals,[0, max(task_s)],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0524             grid;
0525             ylabel(<span class="string">'TEI'</span>);
0526             axis([1 length(task_s) 0 max(task_s)]);
0527             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0528             
0529             subplot(6,1,6);
0530             plot(edaSubVideoList,<span class="string">'k'</span>);
0531             yL = [min(edaSubVideoList) max(edaSubVideoList)];
0532             self.plotIntervals(intervals,yL,max(edaXTime)/max(xname),labels,<span class="string">'r'</span>);
0533             grid;
0534             ylabel(<span class="string">'EDA [µS]'</span>);
0535             l = length(edaSubVideoList);
0536             axis([1,l, yL]);
0537             set(gca,<span class="string">'XTick'</span>,edaXTime,<span class="string">'XTickLabel'</span>,xname);
0538             <span class="comment">%             subplot(7,1,7);</span>
0539             <span class="comment">%             t=0:1/5:videoLength;</span>
0540             <span class="comment">%             t = t(1:end-1);</span>
0541             <span class="comment">%             dydt = diff(edaSubVideoList)./diff(t);</span>
0542             <span class="comment">%             dydt(end+1) = dydt(end);</span>
0543             <span class="comment">%             plot(dydt,'k');</span>
0544             <span class="comment">%             yL = [min(dydt) max(dydt)];</span>
0545             <span class="comment">%             self.plotIntervals(intervals,yL,max(edaXTime)/max(xname),labels,'r');</span>
0546             <span class="comment">%             crossings = find(diff(dydt&gt;0)~=0)+1;</span>
0547             <span class="comment">%             self.plotIntervals(t(cossings),yL,max(edaXTime)/max(xname),[],'b');</span>
0548             <span class="comment">%             line([1 l],[0,0],'Color','b','LineStyle','--');</span>
0549             <span class="comment">%             grid;</span>
0550             <span class="comment">%             xlabel('Time [s]');</span>
0551             <span class="comment">%             ylabel('d(EDA)/dt [µS/s]');</span>
0552             <span class="comment">%             l = length(dydt);</span>
0553             <span class="comment">%             axis([1,l, yL]);</span>
0554             <span class="comment">%             set(gca,'XTick',edaXTime,'XTickLabel',xname);</span>
0555             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0556             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
0557             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0558             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0559             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0560             print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,[fPath,<span class="string">'.pdf'</span>]);
0561             close(fig);
0562         <span class="keyword">end</span>
0563         
0564         
0565         
0566         <span class="comment">%% Plots eeg frequency bands for video</span>
0567         <span class="comment">%   videoLength: Length in seconds as double</span>
0568         <span class="comment">%   fPath: Path to output file as String</span>
0569         <span class="comment">%   theta_s: Theta values as double[]</span>
0570         <span class="comment">%   alpha_s: Alpha values as double[]</span>
0571         <span class="comment">%   beta1_s: Beta1 values as double[]</span>
0572         <span class="comment">%   beta2_s: Beta2 values as double[]</span>
0573         <span class="comment">%   task_s: TEI values as double[]</span>
0574         <span class="comment">%   baselineTheta: Baseline values for theta as double[]</span>
0575         <span class="comment">%   baselineAlpha: Baseline values for alpha as double[]</span>
0576         <span class="comment">%   baselineBeta1: Baseline values for beta1 as double[]</span>
0577         <span class="comment">%   baselineBeta2: Baseline values for beta2 as double[]</span>
0578         <span class="comment">%   baselineTEI: Baseline values for TEI as double[]</span>
0579         <span class="comment">%   resolution: values per second as double</span>
0580         <span class="comment">%   intervals: intervals of interest as int[]</span>
0581         <span class="comment">%   t_title: Diagramm title as String</span>
0582         <a name="_sub11" href="#_subfunctions" class="code">function plotFrequencysWithBaselineMagnitude(self,videoLength,fPath,theta_s,alpha_s,beta1_s,beta2_s,task_s,baselineTheta,baselineAlpha,baselineBeta1,baselineBeta2,baselineTEI,resolution,intervals,t_title)</a>
0583             fig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0584             maxscale = 1.2*(max([max(alpha_s) max(beta1_s) max(beta2_s) max(theta_s)])); <span class="comment">%Add 20% to the maxscale for providing more space for the legend</span>
0585             numDataPoints = videoLength*resolution;
0586             labels = [];
0587             <span class="keyword">if</span> videoLength &gt; 30
0588                 xname = 0:5:videoLength;
0589                 labels = intervals;
0590             <span class="keyword">else</span>
0591                 xname = 0:videoLength;
0592             <span class="keyword">end</span>
0593             xtime = xname .* resolution;
0594             
0595             <span class="comment">%subplots</span>
0596             subplot(6,1,1)
0597             plot(theta_s,<span class="string">'Color'</span>,[65/255 105/255 225/255]);
0598             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0599             m = mean(baselineTheta);
0600             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
0601             grid;
0602             massAndTime = self.calculateMassAndTime(theta_s,numDataPoints,mean(baselineTheta));
0603             
0604             <span class="keyword">if</span>(isempty(intervals))
0605                 legend(massAndTime,<span class="string">'theta baseline mean'</span>);
0606             <span class="keyword">else</span>
0607                 h=legend(massAndTime,<span class="string">'Stimulus'</span>,<span class="string">'theta baseline mean'</span>);
0608                 <span class="comment">%leg_line=findobj(h,'Type','Line'); %%Das funktioniert nicht mehr (Gernot)</span>
0609                 <span class="comment">%set(leg_line(2), 'Color', 'b');</span>
0610             <span class="keyword">end</span>
0611             ylabel(<span class="string">'Theta [µV]'</span>);
0612             axis([0 length(theta_s) 0 maxscale]);
0613             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0614             
0615             title(t_title);
0616             
0617             subplot(6,1,2);
0618             plot(alpha_s,<span class="string">'Color'</span>,[0/255 128/255 0/255]);
0619             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0620             m = mean(baselineAlpha);
0621             hold on;
0622             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
0623             hold off;
0624             massAndTime = self.calculateMassAndTime(alpha_s,numDataPoints,mean(baselineAlpha));
0625             <span class="keyword">if</span>(isempty(intervals))
0626                 legend(massAndTime,<span class="string">'alpha baseline mean'</span>);
0627             <span class="keyword">else</span>
0628                 h= legend(massAndTime,<span class="string">'Stimulus'</span>,<span class="string">'alpha baseline mean'</span>);
0629                 <span class="comment">%leg_line=findobj(h,'Type','Line');%%Das funktioniert nicht mehr (Gernot)</span>
0630                 <span class="comment">%set(h(:,2), 'Color', 'b');</span>
0631             <span class="keyword">end</span>
0632             grid;
0633             ylabel(<span class="string">'Alpha [µV]'</span>);
0634             axis([0 length(alpha_s) 0 maxscale]);
0635             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0636                         
0637             subplot(6,1,3);
0638             plot(beta1_s,<span class="string">'Color'</span>,[255/255 128/255 0/255]);
0639             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0640             m = mean(baselineBeta1);
0641             hold on;
0642             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
0643             hold off;
0644             massAndTime = self.calculateMassAndTime(beta1_s,numDataPoints,mean(baselineBeta1));
0645             <span class="keyword">if</span>(isempty(intervals))
0646                 legend(massAndTime,<span class="string">'beta1 baseline mean'</span>);
0647             <span class="keyword">else</span>
0648                 h= legend(massAndTime,<span class="string">'Stimulus'</span>,<span class="string">'beta1 baseline mean'</span>);
0649                 <span class="comment">%leg_line=findobj(h,'Type','Line');%%Das funktioniert nicht mehr (Gernot)</span>
0650                 <span class="comment">%set(leg_line(2), 'Color', 'b');</span>
0651             <span class="keyword">end</span>
0652             grid;
0653             ylabel(<span class="string">'Beta1 [µV]'</span>);
0654             axis([0 length(beta1_s) 0 maxscale]);
0655             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0656             
0657             subplot(6,1,4);
0658             plot(beta2_s,<span class="string">'Color'</span>,[255/255 69/255 0/255]);
0659             self.plotIntervals(intervals,[0, maxscale],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0660             m = mean(baselineBeta2);
0661             hold on;
0662             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
0663             hold off;
0664             massAndTime = self.calculateMassAndTime(beta2_s,numDataPoints,mean(baselineBeta2));
0665             <span class="keyword">if</span>(isempty(intervals))
0666                 legend(massAndTime,<span class="string">'beta2 baseline mean'</span>);
0667             <span class="keyword">else</span>
0668                 h=legend(massAndTime,<span class="string">'Stimulus'</span>,<span class="string">'beta2 baseline mean'</span>);
0669                 <span class="comment">%leg_line=findobj(h,'Type','Line');%%Das funktioniert nicht mehr (Gernot)</span>
0670                 <span class="comment">%set(leg_line(2), 'Color', 'b');</span>
0671             <span class="keyword">end</span>
0672             grid;
0673             ylabel(<span class="string">'Beta2 [µV]'</span>);
0674             axis([0 length(beta2_s) 0 maxscale]);
0675             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0676             
0677             subplot(6,1,5);
0678             plot(task_s,<span class="string">'k'</span>);
0679             self.plotIntervals(intervals,[0, (1.2*max(task_s))],max(xtime)/max(xname),labels,<span class="string">'r'</span>);
0680             m = mean(baselineTEI);
0681             hold on;
0682             line(<span class="string">'XData'</span>,[0 xtime(end)],<span class="string">'YData'</span>,[m,m],<span class="string">'Color'</span>,<span class="string">'b'</span>)
0683             hold off;
0684             massAndTime = self.calculateMassAndTime(task_s,numDataPoints,mean(baselineTEI));
0685             <span class="keyword">if</span>(isempty(intervals))
0686                 legend(massAndTime,<span class="string">'TEI baseline mean'</span>);
0687             <span class="keyword">else</span>
0688                 h=legend(massAndTime,<span class="string">'Stimulus'</span>,<span class="string">'TEI baseline mean'</span>);
0689                 <span class="comment">%leg_line=findobj(h,'Type','Line');%%Das funktioniert nicht mehr (Gernot)</span>
0690                 <span class="comment">%set(leg_line(2), 'Color', 'b');</span>
0691             <span class="keyword">end</span>
0692             grid;
0693             ylabel(<span class="string">'TEI'</span>);
0694             axis([0 length(task_s) 0 (1.2*max(task_s))]);
0695             set(gca,<span class="string">'XTick'</span>,xtime,<span class="string">'XTickLabel'</span>,xname);
0696                         
0697             set(fig, <span class="string">'PaperType'</span>, <span class="string">'A4'</span>);
0698             set(fig, <span class="string">'PaperOrientation'</span>, <span class="string">'portrait'</span>);
0699             set(fig, <span class="string">'PaperUnits'</span>, <span class="string">'centimeters'</span>);
0700             set(fig, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0701             set(fig, <span class="string">'PaperPosition'</span>, [0.2 0.1 20 29 ]);
0702             print([<span class="string">'-f'</span>,int2str(fig.Number)],<span class="string">'-dpdf'</span>,fPath);
0703             close(fig);
0704         <span class="keyword">end</span>
0705     <span class="keyword">end</span>
0706     
0707     methods(Access=private)   
0708         
0709         <span class="comment">%% Helper method to calculate mass and time</span>
0710         <a name="_sub12" href="#_subfunctions" class="code">function massAndTime = calculateMassAndTime(self,values,numDataPoints, mean)</a>
0711             valuesOverMean = find(values &gt; mean);
0712             overCount = length(valuesOverMean);
0713             overMass = sum(values(valuesOverMean));
0714             mass = int8(overMass/sum(values)*100);
0715             time = int8(overCount/numDataPoints*100);
0716             massAndTime = [num2str(time) <span class="string">'% time | '</span> num2str(mass) <span class="string">'% weighted mass is over baseline'</span>];
0717         <span class="keyword">end</span>
0718         
0719         <span class="comment">%% Helper method to calculate intervals and video start points</span>
0720         <a name="_sub13" href="#_subfunctions" class="code">function [videoStartPoints,videoLabels,intervals,completeVidLength] = calculateVideoStartPointsAndIntervals(self,videoDef)</a>
0721             videoStartPoints = [];
0722             videoLabels={};
0723             intervals = [];
0724             completeVidLength =0;
0725             <span class="keyword">for</span> i=1:length(videoDef)
0726                 completeVidLength = completeVidLength + videoDef{i}.length;
0727                 videoLabels{i} = [<span class="string">'Video'</span> num2str(i)];
0728                 <span class="keyword">if</span> i==1
0729                     videoStartPoints(i) = 0;
0730                 <span class="keyword">else</span>
0731                     videoStartPoints(i) = videoDef{i-1}.length + videoStartPoints(i-1);
0732                 <span class="keyword">end</span>
0733                 curIntervals = videoDef{i}.intervals;
0734                 curIntervals= curIntervals +videoStartPoints(i);
0735                 intervals = horzcat(intervals,curIntervals');
0736             <span class="keyword">end</span>
0737         <span class="keyword">end</span>
0738         
0739         <span class="comment">%% Helper method to plot intervals of interest</span>
0740         <a name="_sub14" href="#_subfunctions" class="code">function plotIntervals(self,intervals,yPos,scaleFac,labels,color)</a>
0741             labels = labels';
0742             <span class="keyword">for</span> i=1:length(intervals)
0743                 xPosition = intervals(i);
0744                 xPosition = xPosition*double(scaleFac);
0745                 line([double(xPosition) double(xPosition)],yPos,<span class="string">'Color'</span>,color);
0746                 <span class="keyword">if</span> ~isempty(labels)
0747                     text([double(xPosition) double(xPosition)],[yPos(2) yPos(2)], num2str(labels(i)), <span class="string">'VerticalAlignment'</span>,<span class="string">'bottom'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'FontSize'</span>,8);
0748                 <span class="keyword">end</span>
0749             <span class="keyword">end</span>
0750         <span class="keyword">end</span>
0751         
0752         <span class="comment">%% Helper method to plot the video start points</span>
0753         <a name="_sub15" href="#_subfunctions" class="code">function plotVideoStartPoints(self,startPoints,labels,yPos,scaleFac)</a>
0754             <span class="keyword">for</span> i=1:length(startPoints)
0755                 xPosition = startPoints(i);
0756                 xPosition = double(xPosition*scaleFac);
0757                 line([xPosition xPosition],yPos,<span class="string">'Color'</span>,<span class="string">'g'</span>);
0758                 text([xPosition xPosition],[yPos(2) yPos(2)], labels(i), <span class="string">'VerticalAlignment'</span>,<span class="string">'bottom'</span>,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="string">'FontSize'</span>,7);
0759             <span class="keyword">end</span>
0760         <span class="keyword">end</span>
0761         
0762     <span class="keyword">end</span>
0763 <span class="keyword">end</span>
0764</pre></div>
<hr><address>Generated on Mon 06-Jan-2020 10:33:39 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>